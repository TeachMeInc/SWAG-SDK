<html>
<head>
  <meta charset='UTF-8' />
  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
  <title>SWAG HTML5 SDK Demo</title>
  <link rel='preconnect' href='https://fonts.googleapis.com'>
  <link rel='preconnect' href='https://fonts.gstatic.com' crossorigin>
  <link href='https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100..900&family=Roboto:wght@300;400;700&display=swap' rel='stylesheet'>
  <style>
    body {
      margin: 0;
      padding: 0;
      width: 100svw;
      height: 100svh;
      background-color: #195AAB;
      font-family: Arial, Helvetica, sans-serif !important;
    }

    canvas {
      display: block;
      margin: 0 auto;
      width: 100%;
      height: 100%;
    }

    #game-ui {
      position: absolute;
      top: 0;
      left: 0;
      padding: 0.5rem 1rem;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      margin: 1rem;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 4px;
    }

    section {
      margin: 0.5rem 0;
    }

    section > h4 {
      font-size: 1.2rem;
      margin: 0 0 0.5rem 0;
      border-bottom: solid 1px #ccc;
    }

    section > p {
      margin: 0.5rem 0;
    }

    section > p {
      margin: -0.25rem 0;
    }

    section > p > button {
      border-radius: 100px;
      border: solid 1px;
      padding: 0.2rem 1rem;
      margin: 0.25rem 0;
      cursor: pointer;
    }

    section > p > input,
    section > p > select {
      border-radius: 4px;
      border: solid 1px;
      padding: 0.2rem;
      margin: 0.25rem 0;
    }
  </style>
</head>
<body>
  <canvas id='game-canvas'></canvas>
  <div id='game-ui'>
    <section>
      <h4>API Methods</h4>
      <p>
        <button id='btnToggleFullScreen'>Toggle Full-Screen</button>
        <button id='btnNavigateToArchives'>Navigate to Archives</button>
        <button id='btnNavigateToTitle'>Navigate to Title</button>
      </p>
    </section>
    <section>
      <h4>UI Methods</h4>
      <p>
        <button id='btnGameSplashScreen'>Splash Screen</button>
        <button id='btnGameSummaryScreen'>Summary Screen</button>
        <button id='btnShowLoader'>Show Loader</button>
        <button id='btnHideLoader'>Hide Loader</button>
      </p>
    </section>
    <section>
      <h4>Toolbar Methods</h4>
      <p>
        <button id='btnUpdateToolbarItem'>Update Toolbar Item</button>
        <button id='btnRemoveToolbarItem'>Remove Toolbar Item</button>
      </p>
    </section>
    <section>
      <h4>User Methods</h4>
      <p>
        <strong>Current User</strong>
        <input id='userInfo' type='text'></input>
      </p>
      <p>
        <button id='btnGetCurrentUser'>Get Current User</button>
        <button id='btnCheckIsSubscriber'>Check Is Subscriber</button>
        <!-- <button id='btnGetUserData'>Get User Data</button> -->
      </p>
      <!-- <p>
        <strong>User Cloud Data</strong>
        <input id='submitCloudData_keyInput' type='text' placeholder='Key' />
        <input id='submitCloudData_valueInput' type='text' placeholder='Value' />
        <button id='submitCloudData_submitBtn'>Save User Data</button>
      </p> -->
    </section>
    <section>
      <h4>Daily Game Methods</h4>
      <p>
        <button id='btnStartDailyGame'>Start Game</button>
        <button id='btnCompleteDailyGame'>Complete Game</button>
        <button id='btnGetDailyGameStreak'>Get Game Streak</button>
        <button id='btnGetDailyGameProgress'>Get Game Progress</button>
        <button id='btnPostDailyScore'>Submit Daily Score</button>
      </p>
    </section>
  </div>
  <script type='module' src='/src/main.ts'></script>
  <style>
    /* :root {
      --swag-l-toolbar-bg-color: #EADAB9;
      --swag-l-toolbar-font-color: #1f1f1f;
      --swag-l-toolbar-border-color: #313131;
      --swag-title-font-family: 'Roboto Slab', serif;
      --swag-toolbar-height: 63px;
      --swag-toolbar-title-font-size: 18px;
      --swag-toolbar-border-width: 1;
    } */
  </style>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const api = SWAGAPI.getInstance({
        // apiKey: '5c6c3c056917a692f96f9651',
        // gameTitle: 'SWAG HTML5 SDK',
        apiKey: '66b3cbb9e2843f375e830980',
        // analytics: {
        //   gameId: 'foobarbaz',
        // },
        debug: true,
        leaderboards: {
          dailyScoreLevelKey: 'daily',
        },
        leaderboardScreen: true,
        splashScreen: {
          isBeta: true,
          showOnLoad: true,
        },
        // summaryScreen: {},
        toolbar: {
          titleIcon: 'https://new.shockwave.com/images/SW25.svg',
          titleIconDark: 'https://new.shockwave.com/images/SW25_alt.svg',
          initialToolbarState: {
            items: [
              { 
                id: 'btn1', 
                icon: 'stopwatch',
                label: '0:00',
              },
              { 
                id: 'btn2', 
                icon: 'pause',
              },
              { 
                id: 'btn3', 
                icon: 'info',
                disabled: true,
              },
              { 
                id: 'btn4', 
                icon: 'info',
                toggled: true,
              },
              {
                id: 'fullScreen',
                icon: 'expand',
                onClick: () => {
                  if (document.fullscreenElement) {
                    document.exitFullscreen();
                  } else {
                    document.body.requestFullscreen();
                  }
                }
              },
            ]
          },
        },
      });
      api.on('SESSION_READY', () => {
        console.log('>> Session ready event fired');
      });

      const game = {
        async init () {
          await api.startSession();

          let toggled = false;
          api.updateToolbarItem({
            id: 'btn2',
            onClick: () => {
              toggled = !toggled;
              api.updateToolbarItem({ 
                id: 'btn2', 
                icon: toggled ? 'play' : 'pause',
              });
            },
          });

          document.getElementById('userInfo').value = JSON.stringify(api.getCurrentEntity());

          let x = 0.5;
          let y = 0.5;
          const xSpeed = 0.001 + Math.random() * 0.005;
          const ySpeed = 0.001 + Math.random() * 0.005;
          let velX = Math.random() > 0.5 ? 1 : -1;
          let velY = Math.random() > 0.5 ? 1 : -1;

          const frame = () => {
            requestAnimationFrame(frame);

            const cvs = document.getElementById('game-canvas');
            cvs.width = window.innerWidth;
            cvs.height = window.innerHeight;

            const ctx = cvs.getContext('2d');
            ctx.fillStyle = '#195AAB';
            ctx.fillRect(0, 0, cvs.width, cvs.height);

            ctx.font = '40px Comic Sans MS';
            ctx.fillStyle = '#FFFFFF';
            ctx.textAlign = 'center';
            const textWidth = ctx.measureText('shockwave.com').width;
            const localX = x * cvs.width - textWidth / 2;
            const localY = y * cvs.height;
            ctx.fillText('shockwave.com', localX, localY);

            if (x > 1) {
              velX = -1;
            } else if (x < 0 + textWidth / cvs.width) {
              velX = 1;
            }

            if (y > 1) {
              velY = -1;
            } else if (y < 0 + 20 / cvs.height) {
              velY = 1;
            }

            x += velX * xSpeed;
            y += velY * ySpeed;
          };
          frame();
        }
      };

      /* --- */

      document.getElementById('btnShowLoader').onclick = 
        () => api.showLoader();

      document.getElementById('btnHideLoader').onclick = 
        () => api.hideLoader();

      document.getElementById('btnPostDailyScore').onclick = 
        () => {
          const value = Math.floor(Math.random() * 1000);
          api.postDailyScore(value);
        };

      document.getElementById('btnGameSplashScreen').onclick = 
        () => api.showSplashScreen({
          onClickPlay: () => { alert('Play clicked.'); },
        });

      document.getElementById('btnGameSummaryScreen').onclick = 
        () => api.showSummaryScreen({
          stats: [
            { key: 'Time', value: '1:00' },
          ], 
          contentHtml: '<div style="background:#ccc;width:100%;height:100px;">Preview</div>',
          shareString: 'You have completed the game, this is the share string!!',
          onFavorite: () => { alert('favorite clicked'); },
          onReplay: () => { alert('replay clicked'); },
          onClose: () => { alert('share screen closed'); }
      });

      document.getElementById('btnToggleFullScreen').onclick = 
        () => api.toggleFullScreen();

      document.getElementById('btnNavigateToArchives').onclick = 
        () => api.navigateToArchive();

      document.getElementById('btnNavigateToTitle').onclick = 
        () => api.navigateToTitle('jigsawpuzzles');

      // document.getElementById('submitCloudData_submitBtn').onclick = 
      //   () => {
      //     const key = document.getElementById('submitCloudData_keyInput').value;
      //     const value = document.getElementById('submitCloudData_valueInput').value;
      //     api.setUserData(key, value);
      //   };

      document.getElementById('btnGetCurrentUser').onclick = 
        async () => console.log(await api.getCurrentEntity());

      document.getElementById('btnCheckIsSubscriber').onclick = 
        async () => console.log(await api.isSubscriber());

      // document.getElementById('btnGetUserData').onclick = 
      //   async () => console.log(await api.getUserData());

      document.getElementById('btnUpdateToolbarItem').onclick = 
        () => api.updateToolbarItem({ 
          id: 'btn1', 
          label: new Date().toLocaleTimeString([], { minute: '2-digit', second: '2-digit' }), 
          icon: 'stopwatch',
        });

      document.getElementById('btnRemoveToolbarItem').onclick = 
        () => api.removeToolbarItem('btn1');

      const today = new Date().toISOString().split('T')[0];

      document.getElementById('btnStartDailyGame').onclick = 
        () => api.startDailyGame(today, { foo: 'bar' });

      document.getElementById('btnCompleteDailyGame').onclick = 
        () => api.completeDailyGame(today, { bar: 'baz' });

      document.getElementById('btnGetDailyGameStreak').onclick = 
        async () => console.log(await api.getDailyGameStreak());

      /* --- */

      game.init();
    });
  </script>
</body>
</html>